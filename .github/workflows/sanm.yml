name: QQ Notification Sender

on: [push]

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Extract commit info 
        id: commit-info
        run: |
          # å®Œæ•´å¤„ç†å¤šè¡Œæäº¤æ¶ˆæ¯
          COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | sed ':a;N;$!ba;s/\n/ | /g')
          
          # æå–æäº¤ä¿¡æ¯ç¬¬ä¸€è¡Œä½œä¸ºæ‘˜è¦
          SUBJECT=$(echo "$COMMIT_MSG" | cut -d'|' -f1 | sed 's/^ //')
          
          # æå–å‰©ä½™éƒ¨åˆ†ä½œä¸ºæè¿°
          BODY=$(echo "$COMMIT_MSG" | cut -d'|' -f2- | sed 's/^ //')
          
          # æ ¼å¼åŒ–æ—¶é—´æˆ³
          TIME=$(date -d "${{ github.event.head_commit.timestamp }}" +"%Y-%m-%d %H:%M:%S")
          
          SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-8)

          # ä½¿ç”¨ç¯å¢ƒæ–‡ä»¶è®¾ç½®è¾“å‡ºå˜é‡ï¼ˆæ–°æ ‡å‡†ï¼‰
          echo "subject=$SUBJECT" >> $GITHUB_OUTPUT
          echo "body=$BODY" >> $GITHUB_OUTPUT
          echo "time=$TIME" >> $GITHUB_OUTPUT
          echo "short_sha=$SHORT_SHA" >> $GITHUB_OUTPUT
      
      - name: Send Notification
        uses: Y2Nk4/qmsg-action@master
        with:
          qq: ${{ secrets.QMSG_NOTIFY_QQ }}
          groups: ${{ secrets.QMSG_NOTIFY_GROUPS }}
          key: ${{ secrets.QMSG_KEY }}
          message: |
            ğŸ“Œ [${{ github.repository }}] æäº¤å®Œæˆ
            ğŸ‘¤ æäº¤è€…: ${{ github.actor }}
             ğŸŒ¿ åˆ†æ”¯: ${{ github.ref_name }}
            ğŸ†” æäº¤å“ˆå¸Œ: ${{ steps.commit-info.outputs.short_sha }}
            â±ï¸ æäº¤æ—¶é—´: ${{ steps.commit-info.outputs.time }}
            ğŸ“ æ‘˜è¦: ${{ steps.commit-info.outputs.subject }}
            ğŸ“– æè¿°: ${{ steps.commit-info.outputs.body }}
            ğŸ”— æŸ¥çœ‹æäº¤: github.com/${{ github.repository }}/commit/${{ github.sha }}