#!/bin/bash

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# ==================== âœ¨ åˆå¹¶æäº¤æ‹¦æˆªåŒºåŸŸ (ç¬¬ä¸€ä¼˜å…ˆçº§) âœ¨ ====================
# å¦‚æžœæ˜¯ merge æ“ä½œï¼Œæˆ–è€…æ–‡ä»¶ä¸­åŒ…å«é»˜è®¤çš„ Merge branch ä¿¡æ¯
if [ "$COMMIT_SOURCE" = "merge" ] || grep -q "^Merge branch" "$COMMIT_MSG_FILE"; then
    # è¯»å–åŽŸå§‹ä¿¡æ¯
    ORIGINAL_MSG=$(cat "$COMMIT_MSG_FILE")
    # å°è¯•æå–åˆ†æ”¯å (æå–å•å¼•å·å†…çš„å†…å®¹ æˆ– Merge branch åŽçš„ç¬¬ä¸€ä¸ªè¯)
    BRANCH_NAME=$(echo "$ORIGINAL_MSG" | sed -n "s/^Merge branch '\([^']*\)'.*/\1/p")
    if [ -z "$BRANCH_NAME" ]; then
        BRANCH_NAME=$(echo "$ORIGINAL_MSG" | sed -n "s/^Merge branch \([^ ]*\).*/\1/p")
    fi
    # æ¸…ç† origin/ å‰ç¼€
    BRANCH_NAME=${BRANCH_NAME#origin/}

    # å†™å…¥æ–°æ¨¡æ¿
    cat > "$COMMIT_MSG_FILE" << EOF
Merge:'$BRANCH_NAME'| è¯·åœ¨æ­¤è¾“å…¥åŠŸèƒ½æè¿°(å¿…å¡«)

# ðŸš§ðŸš§ðŸš§ è¯·ä¿®æ”¹ä¸Šæ–¹ '|' åŽçš„æè¿°ï¼ä¿æŒä¸€è¡Œï¼ðŸš§ðŸš§ðŸš§
# æ ¼å¼: Merge:'åˆ†æ”¯å'| æè¿°
# ç¤ºä¾‹: Merge:'feat/gacha-v2'| æŠ½å¡ç³»ç»ŸV2é‡æž„
#
# ï¼ˆã€å¯é€‰åŠŸèƒ½ï¼Œè‡ªè¡Œåˆ é™¤æ³¨é‡ŠåŽæ›¿æ¢***å†…å®¹ã€‘
# BREAKING CHANGE:ï¼ˆ***ç ´åæ€§å˜æ›´è­¦ç¤ºâš ï¸ï¼Œæ…Žç”¨ï¼‰
# HIGHLIGHT:***ï¼ˆäº®ç‚¹åŠŸèƒ½æ ‡è®°ðŸ’¡ï¼Œæ…Žç”¨ï¼‰
# Co-authored-by:***ï¼ˆåä½œè€…åç§°ðŸ‘¥ï¼‰
# ã€ðŸš¨å¯è‡ªå®šä¹‰ä¿¡æ¯å½•å…¥å®Œæ¯•ðŸš¨ã€‘æäº¤ä¿¡æ¯è¯·åœ¨æ­¤è¡Œä»¥ä¸Šâ˜ï¸â˜ï¸â˜ï¸è¾“å…¥å®Œæ¯•ã€‚

# ã€ðŸ—ï¸å‘ç‰ˆæŽ§åˆ¶ã€‘å¦‚æžœè¦å‘å¸ƒå†…æµ‹ç‰ˆï¼Œè¯·åˆ é™¤ä¸‹é¢ä¸€è¡Œå¼€å¤´çš„#å·
#[deploy-beta]
# =========== åŽŸå§‹ä¿¡æ¯ ===========
# $ORIGINAL_MSG
EOF
    # å¤„ç†å®Œæ¯•ï¼Œç›´æŽ¥é€€å‡º
    exit 0
fi

# ====================çŽ°æœ‰è¾“å…¥ä¿æŠ¤åŒºåŸŸ===================
# å¦‚æžœæäº¤ä¿¡æ¯å·²ç»æœ‰æ¥æº (ä¾‹å¦‚ VSCode è¾“å…¥æ¡†ã€git commit -mã€git commit --amend)
# åˆ™ç›´æŽ¥é€€å‡ºï¼Œç»å¯¹ä¸è¦è¦†ç›–ç”¨æˆ·å·²ç»å†™å¥½çš„å†…å®¹ï¼
if [ -n "$COMMIT_SOURCE" ]; then
    exit 0
fi

# ==================== ðŸ“ ç©ºç™½æäº¤å¸®æ‰¶åŒºåŸŸ (ä»…æ— å‚ git commit è§¦å‘) ====================
# ä¸­æ–‡å¸®æ‰¶æ¨¡æ¿
cat > "$COMMIT_MSG_FILE" << 'EOF'
# =========== è¯·æŒ‰ç…§ä»¥ä¸‹è¯­æ³•ç¼–å†™æäº¤ä¿¡æ¯ ===========
# "ðŸ’ å·²æ‰“å¼€æäº¤ä¿¡æ¯ç¼–è¾‘å™¨"
#
# å¯è®¾ç½®VSCodeä¸ºé»˜è®¤ç¼–è¾‘å™¨ï¼Œå¤§å¤§æå‡ä½“éªŒï¼š
# git config --global core.editor "code --wait"
# æ›´å¤šç¼–è¾‘å™¨å‚è€ƒåŽæ–‡
# 
# ä»¥ '#' å¼€å¤´çš„è¡Œå°†è¢«å¿½ç•¥ã€‚
# 
# "ðŸš¸ä½¿ç”¨è¯´æ˜Žï¼š"
# "   1. å°†ã€è¯·åœ¨æ­¤è¾“å…¥æäº¤æ ‡é¢˜ã€‘æ›¿æ¢ä¸ºå¸¦å‰ç¼€çš„å®žé™…æ ‡é¢˜"
# "   2. å°†ã€è¯·åœ¨æ­¤è¾“å…¥æäº¤æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ã€‘æ›¿æ¢ä¸ºå®žé™…æè¿°" 
# "   3. å¦‚éœ€å‘å¸ƒå†…æµ‹ç‰ˆï¼Œåˆ é™¤ #[deploy-beta] å‰çš„ # å·"
# "   4. ä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨ï¼Œå³å¯å®Œæˆæäº¤"
#
# "ðŸ›‘ç©ºç™½çš„æäº¤ä¿¡æ¯ã€ä¸å‚¨å­˜ç›´æŽ¥å…³é—­æ–‡æœ¬æ¡†å°†ä¸­æ­¢æäº¤ã€‚
#
# è¯·åœ¨ä¸‹é¢è¾“å…¥æäº¤æ ‡é¢˜ï¼ˆç®€çŸ­æè¿°ï¼‰
# æ³¨æ„ï¼šæ ‡é¢˜è¡Œä¸è¦ä»¥#å·å¼€å¤´
# ðŸš§ðŸš§ðŸš§     ðŸ“ç¬¬ä¸€æ­¥ï¼šðŸ‘‡åœ¨ä¸‹è¡Œæ’°å†™æäº¤æ ‡é¢˜ï¼(subject)    ðŸš§ðŸš§ðŸš§  

#ï¼ˆæ ‡é¢˜å…è®¸è®¾ç½®â†’ç ´åæ€§å˜æ›´æ ‡è®°:ä¸»é¢˜ä¸­ä½¿ç”¨æ„Ÿå¹å·"feat!: ***")
# è¯·ä¿ç•™ä¸‹æ–¹ç©ºè¡Œï¼ˆæ ‡é¢˜å’Œæ­£æ–‡ä¹‹é—´å¿…é¡»æœ‰ç©ºè¡Œï¼‰


#  è¯·åœ¨ä¸‹é¢è¾“å…¥æäº¤æ­£æ–‡ï¼ˆè¯¦ç»†æè¿°ï¼Œå¯é€‰ï¼‰
# ðŸš§ðŸš§ðŸš§     ðŸ“ç¬¬äºŒæ­¥ï¼šðŸ‘‡è¯·åœ¨ä¸‹æ–¹è¡Œä¸­è¾“å…¥æäº¤æ­£æ–‡ï¼ˆå¯é€‰ï¼‰(body)    ðŸš§ðŸš§ðŸš§

# ï¼ˆã€å¯é€‰åŠŸèƒ½ï¼Œè‡ªè¡Œåˆ é™¤æ³¨é‡ŠåŽæ›¿æ¢***å†…å®¹ã€‘
# BREAKING CHANGE:ï¼ˆ***ç ´åæ€§å˜æ›´è­¦ç¤ºâš ï¸ï¼Œæ…Žç”¨ï¼‰
# HIGHLIGHT:***ï¼ˆäº®ç‚¹åŠŸèƒ½æ ‡è®°ðŸ’¡ï¼Œæ…Žç”¨ï¼‰
# Co-authored-by:***ï¼ˆåä½œè€…åç§°ðŸ‘¥ï¼‰
# ã€ðŸš¨å¯è‡ªå®šä¹‰ä¿¡æ¯å½•å…¥å®Œæ¯•ðŸš¨ã€‘æäº¤ä¿¡æ¯è¯·åœ¨æ­¤è¡Œä»¥ä¸Šâ˜ï¸â˜ï¸â˜ï¸è¾“å…¥å®Œæ¯•ã€‚

# ã€ðŸ—ï¸å‘ç‰ˆæŽ§åˆ¶ã€‘å¦‚æžœè¦å‘å¸ƒå†…æµ‹ç‰ˆï¼Œè¯·åˆ é™¤ä¸‹é¢ä¸€è¡Œå¼€å¤´çš„#å·
#[deploy-beta]
# æ³¨æ„ï¼šè¯·ç¡®ä¿è¿™æ˜¯æœ€åŽä¸€è¡Œï¼Œä¸”å‰åŽä¸è¦æœ‰ç©ºè¡Œ


# =========== ä»¥ä¸‹ä¸ºGitè‡ªåŠ¨ç”Ÿæˆçš„ä¿¡æ¯ï¼Œè¯·å‹¿ä¿®æ”¹ ===========
# ä»¥ '#' å¼€å¤´çš„è¡Œå°†è¢«å¿½ç•¥ã€‚
#
# åœ¨å‘½ä»¤è¡Œè¾“å‡ºæäº¤å‰ç¼€è§„èŒƒ
# ""
# "ðŸš€ æäº¤å‰ç¼€è§„èŒƒï¼ˆè¯·åœ¨æ ‡é¢˜ä¸­ä½¿ç”¨ï¼‰ï¼š"
# "=========================================="
# "âœ¨ feat     - æ–°åŠŸèƒ½        (ç¤ºä¾‹: feat(ui): æ·»åŠ ä¸»é¢˜åˆ‡æ¢)"
# "ðŸ› fix      - Bugä¿®å¤       (ç¤ºä¾‹: fix: è§£å†³å†…å­˜æ³„æ¼)"
# "ðŸ’ª impr     - åŠŸèƒ½å¢žå¼º      (ç¤ºä¾‹: impr: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ)"
# "ðŸšœ refactor - ä»£ç é‡æž„      (ç¤ºä¾‹: refactor(core): ä¼˜åŒ–ç»“æž„)"
# "ðŸš€ perf     - æ€§èƒ½ä¼˜åŒ–      (ç¤ºä¾‹: perf: åŠ é€Ÿæ¸²æŸ“20%)"
# "ðŸ“š docs     - æ–‡æ¡£          (ç¤ºä¾‹: docs: æ›´æ–°APIæ–‡æ¡£)"
# "ðŸŽ¨ style    - æ ·å¼          (ç¤ºä¾‹: style: è°ƒæ•´æŒ‰é’®é—´è·)"
# "ðŸ§ª test     - æµ‹è¯•          (ç¤ºä¾‹: test(auth): å¢žåŠ å•å…ƒæµ‹è¯•)"
# "âš™ï¸  ci       - æŒç»­é›†æˆ      (ç¤ºä¾‹: ci: æ·»åŠ è‡ªåŠ¨åŒ–éƒ¨ç½²)"
# "ðŸ”§ chore    - æ—¥å¸¸ç»´æŠ¤      (ç¤ºä¾‹: chore: æ›´æ–°ä¾èµ–)"
# "â—€ï¸  revert   - æ’¤é”€ x        (ç¤ºä¾‹: revert: å›žé€€é”™è¯¯æäº¤)"
# "ðŸ”’ security - å®‰å…¨  x       (ç¤ºä¾‹: æäº¤bodyå«securityå…³é”®è¯)"
# ""
# "ðŸ“‹ å˜æ›´æ—¥å¿—æ•ˆæžœï¼š"
# "   - âœ¨ feat â†’ æ˜¾ç¤ºä¸º'æ–°åŠŸèƒ½'"
# "   - ðŸ› fix  â†’ æ˜¾ç¤ºä¸º'Bugä¿®å¤'"
# "   - ä»¥æ­¤ç±»æŽ¨..."
# ""
# "ðŸŽ¯ ç‰¹æ®Šæ ‡è®°è¯­æ³•ï¼ˆè®©æäº¤ä¿¡æ¯æ›´ç”ŸåŠ¨ï¼‰"
# "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
# ""
# "âš ï¸ ç ´åæ€§å˜æ›´æ ‡è®°ï¼ˆç”¨æˆ·éœ€è¦æ³¨æ„çš„é‡è¦å˜æ›´ï¼‰"
# "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
# "   â”‚ å¯ç”¨æ–¹æ³•ï¼š                                              â”‚"
# "   â”‚   â€¢ æ ‡é¢˜ä¸­ä½¿ç”¨æ„Ÿå¹å·: feat!: ç§»é™¤æ—§API                 â”‚"
# "   â”‚   â€¢ æ­£æ–‡ä¸­æ·»åŠ : BREAKING CHANGE: æŽ¥å£å·²å˜æ›´            â”‚"
# "   â”‚   â€¢ æ··åˆä½¿ç”¨æ•ˆæžœæ›´ä½³                                   â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚ æ˜¾ç¤ºæ•ˆæžœï¼šâš ï¸ [ç ´åæ€§å˜æ›´]                              â”‚"
# "   â”‚ è®¾è®¡ç›®çš„ï¼šå¯¹ç”¨æˆ·æœ‰æ˜Žæ˜¾å½±å“çš„å˜æ›´                       â”‚"
# "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
# ""
# "ðŸ’¡ äº®ç‚¹åŠŸèƒ½æ ‡è®°ï¼ˆå€¼å¾—å…³æ³¨çš„æ–°ç‰¹æ€§ï¼‰"
# "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
# "   â”‚ å¯ç”¨æ–¹æ³•ï¼š                                              â”‚"
# "   â”‚   â€¢ æ­£æ–‡ä¸­æ·»åŠ : HIGHLIGHT: é‡è¦æ–°åŠŸèƒ½                   â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚ æ˜¾ç¤ºæ•ˆæžœï¼šðŸ’¡ åœ¨æäº¤ä¿¡æ¯å‰æ·»åŠ ç¯æ³¡å›¾æ ‡                  â”‚"
# "   â”‚ ä½¿ç”¨åœºæ™¯ï¼šé‡å¤§æ›´æ–°ã€æ ¸å¿ƒåŠŸèƒ½å¢žå¼º                       â”‚"
# "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
# ""
# "ðŸ‘¥ åä½œè€…æ ‡è®°ï¼ˆå¤šäººåä½œæ—¶ä½¿ç”¨ï¼‰"
# "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
# "   â”‚ å¯ç”¨æ–¹æ³•ï¼š                                              â”‚"
# "   â”‚   â€¢ æ­£æ–‡ä¸­æ·»åŠ : Co-authored-by: åä½œè€…å§“å              â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚ æ˜¾ç¤ºæ•ˆæžœï¼š@æäº¤è€… ðŸ‘¥åä½œè€…å§“å                         â”‚"
# "   â”‚ ä½¿ç”¨åœºæ™¯ï¼šå¤šäººå…±åŒå®Œæˆçš„æäº¤                            â”‚"
# "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
# ""
# "ðŸŽª å®Œæ•´ç¤ºä¾‹å±•ç¤º"
# "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
# "   â”‚ ç ´åæ€§å˜æ›´ç¤ºä¾‹ï¼š                                        â”‚"
# "   â”‚   feat!: ç§»é™¤ç”¨æˆ·ç®¡ç†æ—§API                             â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚   BREAKING CHANGE: ç”¨æˆ·æŽ¥å£å®Œå…¨é‡æž„ï¼Œè¯·æ›´æ–°å®¢æˆ·ç«¯       â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚ äº®ç‚¹åŠŸèƒ½ç¤ºä¾‹ï¼š                                          â”‚"
# "   â”‚   feat: æ–°å¢žAIå¯¹è¯åŠŸèƒ½                                 â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚   HIGHLIGHT: é›†æˆGPT-4ï¼Œæ”¯æŒå¤šè½®å¯¹è¯                   â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚ åä½œè€…ç¤ºä¾‹ï¼š                                            â”‚"
# "   â”‚   fix: ä¿®å¤ç™»å½•éªŒè¯æ¼æ´ž                                â”‚"
# "   â”‚                                                        â”‚"
# "   â”‚   Co-authored-by: å¼ ä¸‰                                â”‚"
# "   â”‚   Co-authored-by: æŽå››                                â”‚"
# "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
# ""
# "ðŸ’Ž å°è´´å£«ï¼š"
# "   â€¢ ç ´åæ€§å˜æ›´æ ‡è®°ä¼šè®©ç”¨æˆ·ç‰¹åˆ«æ³¨æ„è¿™ä¸ªæ›´æ–°"
# "   â€¢ äº®ç‚¹åŠŸèƒ½æ ‡è®°é€‚åˆå±•ç¤ºé‡è¦çš„æ–°ç‰¹æ€§"
# "   â€¢ åä½œè€…æ ‡è®°è®©å›¢é˜Ÿè´¡çŒ®æ›´åŠ é€æ˜Ž"
# ""
#   ã€ç ´åæ€§å˜æ›´æ ‡è®°ã€‘ï¼šæ­¤æ›´æ–°åœ¨ä¿¡æ¯åˆ—è¡¨ä¸­åŠ æ³¨â€˜è­¦å‘Šâ€™è¡¨æƒ…ç¬¦å·
#   è®¾è®¡ç›®çš„ï¼šæŒ‡å¯¹ç”¨æˆ·æœ‰æ˜Žæ˜¾å½±å“ï¼Œä¸å…³æ³¨æœ‰å—æŸå®³å¯èƒ½çš„æ›´æ–°
#   å¯ç”¨æ–¹æ³•ï¼šåœ¨ä¸»é¢˜ä¸­ä½¿ç”¨æ„Ÿå¹å·,"feat!: ***"ã€åœ¨æäº¤ä¿¡æ¯æ­£æ–‡ä¸­æ·»åŠ ,git commit -m "feat: ** | body:| BREAKING CHANGE:***"ã€æ··åˆä½¿ç”¨
#
# æŸ¥çœ‹å½“å‰çš„Gitç¼–è¾‘å™¨é…ç½®
#git config --global core.editor
#
# æŸ¥çœ‹æ‰€æœ‰Gité…ç½®
#git config --global --list
# VSCode
#git config --global core.editor "code --wait"
#
# VSCode Insiders
#git config --global core.editor "code-insiders --wait"
#
# Sublime Text
#git config --global core.editor "subl -n -w"
#
# Atom
#git config --global core.editor "atom --wait"
#
# Notepad++
#git config --global core.editor "'C:/Program Files/Notepad++/notepad++.exe' -multiInst -notabbar -nosession -noPlugin"
EOF